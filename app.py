import streamlit as st
import database
import psycopg2
import json
from compare_logic import *

def get_query_result(query):
    # DBConnection takes 5 arguments
    connection = database.DBConnection()
    result = connection.execute(query)[0][0]
    connection.close()
    return result

def get_description(json_obj):
    descriptions = get_text(json_obj)
    result = ""
    for description in descriptions:
        result = result + description + "\n"
    return result

def get_tree(json_obj):
    head = parse_json(json_obj)
    return generate_tree("", head)

def get_difference(json_object_A, json_object_B):
    diff = get_diff(json_object_A, json_object_B)
    return diff


st.title('PostgreSQL Query Optimizer : Fake Picasso')
col1, col2 = st.beta_columns(2)


with col1:
    input_query1 = st.text_area('Enter your query 1 here.', height=400)
with col2:
    input_query2 = st.text_area('Enter your query 2 here.', height=400)

# Convert input query to explain analyse
if st.button('Submit'):
    with st.spinner('Hang on while we optimize your query to go brrr....'):
        input_query_base = "explain (analyze, costs, verbose, buffers, format json) " + input_query1
        input_query_modified = "explain (analyze, costs, verbose, buffers, format json) " + input_query2

        query_result_base = get_query_result(input_query_base)
        query_result_modified = get_query_result(input_query_modified)

        query_result_base = [([{'Plan': {'Node Type': 'Sort', 'Parallel Aware': False, 'Startup Cost': 260660.94, 'Total Cost': 260731.07, 'Plan Rows': 28055, 'Plan Width': 71, 'Actual Startup Time': 1169.767, 'Actual Total Time': 1169.767, 'Actual Rows': 0, 'Actual Loops': 1, 'Output': ['customer.c_name', 'customer.c_custkey', 'orders.o_orderkey', 'orders.o_orderdate', 'orders.o_totalprice', '(sum(lineitem.l_quantity))'], 'Sort Key': ['orders.o_totalprice DESC', 'orders.o_orderdate'], 'Sort Method': 'quicksort', 'Sort Space Used': 25, 'Sort Space Type': 'Memory', 'Shared Hit Blocks': 10307, 'Shared Read Blocks': 105782, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 140, 'Temp Written Blocks': 140, 'Plans': [{'Node Type': 'Aggregate', 'Strategy': 'Sorted', 'Partial Mode': 'Simple', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Startup Cost': 257957.0, 'Total Cost': 258588.24, 'Plan Rows': 28055, 'Plan Width': 71, 'Actual Startup Time': 1169.762, 'Actual Total Time': 1169.762, 'Actual Rows': 0, 'Actual Loops': 1, 'Output': ['customer.c_name', 'customer.c_custkey', 'orders.o_orderkey', 'orders.o_orderdate', 'orders.o_totalprice', 'sum(lineitem.l_quantity)'], 'Group Key': ['customer.c_custkey', 'orders.o_orderkey'], 'Shared Hit Blocks': 10307, 'Shared Read Blocks': 105782, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 140, 'Temp Written Blocks': 140, 'Plans': [{'Node Type': 'Sort', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Startup Cost': 257957.0, 'Total Cost': 258027.14, 'Plan Rows': 28055, 'Plan Width': 44, 'Actual Startup Time': 1169.761, 'Actual Total Time': 1169.761, 'Actual Rows': 0, 'Actual Loops': 1, 'Output': ['customer.c_custkey', 'orders.o_orderkey', 'customer.c_name', 'orders.o_orderdate', 'orders.o_totalprice', 'lineitem.l_quantity'], 'Sort Key': ['customer.c_custkey', 'orders.o_orderkey'], 'Sort Method': 'quicksort', 'Sort Space Used': 25, 'Sort Space Type': 'Memory', 'Shared Hit Blocks': 10307, 'Shared Read Blocks': 105782, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 140, 'Temp Written Blocks': 140, 'Plans': [{'Node Type': 'Nested Loop', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Join Type': 'Inner', 'Startup Cost': 200312.86, 'Total Cost': 255884.3, 'Plan Rows': 28055, 'Plan Width': 44, 'Actual Startup Time': 1169.758, 'Actual Total Time': 1169.758, 'Actual Rows': 0, 'Actual Loops': 1, 'Output': ['customer.c_custkey', 'orders.o_orderkey', 'customer.c_name', 'orders.o_orderdate', 'orders.o_totalprice', 'lineitem.l_quantity'], 'Shared Hit Blocks': 10307, 'Shared Read Blocks': 105782, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 140, 'Temp Written Blocks': 140, 'Plans': [{'Node Type': 'Hash Join', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Join Type': 'Inner', 'Startup Cost': 200312.43, 'Total Cost': 247230.57, 'Plan Rows': 7012, 'Plan Width': 43, 'Actual Startup Time': 1169.758, 'Actual Total Time': 1169.758, 'Actual Rows': 0, 'Actual Loops': 1, 'Output': ['customer.c_name', 'customer.c_custkey', 'orders.o_orderkey', 'orders.o_orderdate', 'orders.o_totalprice', 'lineitem_1.l_orderkey'], 'Hash Cond': '(orders.o_orderkey = lineitem_1.l_orderkey)', 'Shared Hit Blocks': 10307, 'Shared Read Blocks': 105782, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 140, 'Temp Written Blocks': 140, 'Plans': [{'Node Type': 'Hash Join', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Join Type': 'Inner', 'Startup Cost': 5477.04, 'Total Cost': 52337.28, 'Plan Rows': 14024, 'Plan Width': 39, 'Actual Startup Time': 23.761, 'Actual Total Time': 23.761, 'Actual Rows': 1, 'Actual Loops': 1, 'Output': ['customer.c_name', 'customer.c_custkey', 'orders.o_orderkey', 'orders.o_orderdate', 'orders.o_totalprice'], 'Hash Cond': '(orders.o_custkey = customer.c_custkey)', 'Shared Hit Blocks': 3586, 'Shared Read Blocks': 0, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 0, 'Temp Written Blocks': 0, 'Plans': [{'Node Type': 'Seq Scan', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Relation Name': 'orders', 'Schema': 'public', 'Alias': 'orders', 'Startup Cost': 0.0, 'Total Cost': 41095.0, 'Plan Rows': 1500000, 'Plan Width': 20, 'Actual Startup Time': 0.012, 'Actual Total Time': 0.013, 'Actual Rows': 29, 'Actual Loops': 1, 'Output': ['orders.o_orderkey', 'orders.o_custkey', 'orders.o_orderstatus', 'orders.o_totalprice', 'orders.o_orderdate', 'orders.o_orderpriority', 'orders.o_clerk', 'orders.o_shippriority', 'orders.o_comment'], 'Shared Hit Blocks': 1, 'Shared Read Blocks': 0, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 0, 'Temp Written Blocks': 0}, {'Node Type': 'Hash', 'Parent Relationship': 'Inner', 'Parallel Aware': False, 'Startup Cost': 5459.51, 'Total Cost': 5459.51, 'Plan Rows': 1402, 'Plan Width': 23, 'Actual Startup Time': 23.733, 'Actual Total Time': 23.734, 'Actual Rows': 1499, 'Actual Loops': 1, 'Output': ['customer.c_name', 'customer.c_custkey'], 'Hash Buckets': 2048, 'Original Hash Buckets': 2048, 'Hash Batches': 1, 'Original Hash Batches': 1, 'Peak Memory Usage': 98, 'Shared Hit Blocks': 3585, 'Shared Read Blocks': 0, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 0, 'Temp Written Blocks': 0, 'Plans': [{'Node Type': 'Seq Scan', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Relation Name': 'customer', 'Schema': 'public', 'Alias': 'customer', 'Startup Cost': 0.0, 'Total Cost': 5459.51, 'Plan Rows': 1402, 'Plan Width': 23, 'Actual Startup Time': 0.017, 'Actual Total Time': 23.493, 'Actual Rows': 1499, 'Actual Loops': 1, 'Output': ['customer.c_name', 'customer.c_custkey'], 'Filter': "(customer.c_acctbal < '-891.01'::numeric)", 'Rows Removed by Filter': 148501, 'Shared Hit Blocks': 3585, 'Shared Read Blocks': 0, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 0, 'Temp Written Blocks': 0}]}]}, {'Node Type': 'Hash', 'Parent Relationship': 'Inner', 'Parallel Aware': False, 'Startup Cost': 194124.88, 'Total Cost': 194124.88, 'Plan Rows': 56841, 'Plan Width': 4, 'Actual Startup Time': 1145.964, 'Actual Total Time': 1145.964, 'Actual Rows': 0, 'Actual Loops': 1, 'Output': ['lineitem_1.l_orderkey'], 'Hash Buckets': 65536, 'Original Hash Buckets': 65536, 'Hash Batches': 1, 'Original Hash Batches': 1, 'Peak Memory Usage': 512, 'Shared Hit Blocks': 6721, 'Shared Read Blocks': 105782, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 140, 'Temp Written Blocks': 140, 'Plans': [{'Node Type': 'Aggregate', 'Strategy': 'Sorted', 'Partial Mode': 'Simple', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Startup Cost': 192386.97, 'Total Cost': 193556.47, 'Plan Rows': 56841, 'Plan Width': 4, 'Actual Startup Time': 1145.963, 'Actual Total Time': 1145.963, 'Actual Rows': 0, 'Actual Loops': 1, 'Output': ['lineitem_1.l_orderkey'], 'Group Key': ['lineitem_1.l_orderkey'], 'Filter': "(sum(lineitem_1.l_quantity) > '300'::numeric)", 'Rows Removed by Filter': 58803, 'Shared Hit Blocks': 6721, 'Shared Read Blocks': 105782, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 140, 'Temp Written Blocks': 140, 'Plans': [{'Node Type': 'Sort', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Startup Cost': 192386.97, 'Total Cost': 192539.96, 'Plan Rows': 61198, 'Plan Width': 9, 'Actual Startup Time': 1124.348, 'Actual Total Time': 1129.373, 'Actual Rows': 60008, 'Actual Loops': 1, 'Output': ['lineitem_1.l_orderkey', 'lineitem_1.l_quantity'], 'Sort Key': ['lineitem_1.l_orderkey'], 'Sort Method': 'external sort', 'Sort Space Used': 1120, 'Sort Space Type': 'Disk', 'Shared Hit Blocks': 6721, 'Shared Read Blocks': 105782, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 140, 'Temp Written Blocks': 140, 'Plans': [{'Node Type': 'Seq Scan', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Relation Name': 'lineitem', 'Schema': 'public', 'Alias': 'lineitem_1', 'Startup Cost': 0.0, 'Total Cost': 187521.36, 'Plan Rows': 61198, 'Plan Width': 9, 'Actual Startup Time': 0.128, 'Actual Total Time': 1102.817, 'Actual Rows': 60008, 'Actual Loops': 1, 'Output': ['lineitem_1.l_orderkey', 'lineitem_1.l_quantity'], 'Filter': '(lineitem_1.l_extendedprice < 1497.57)', 'Rows Removed by Filter': 5941207, 'Shared Hit Blocks': 6721, 'Shared Read Blocks': 105782, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 0, 'Temp Written Blocks': 0}]}]}]}]}, {'Node Type': 'Index Scan', 'Parent Relationship': 'Inner', 'Parallel Aware': False, 'Scan Direction': 'Forward', 'Index Name': 'lineitem_pkey', 'Relation Name': 'lineitem', 'Schema': 'public', 'Alias': 'lineitem', 'Startup Cost': 0.43, 'Total Cost': 1.07, 'Plan Rows': 16, 'Plan Width': 9, 'Actual Startup Time': 0.0, 'Actual Total Time': 0.0, 'Actual Rows': 0, 'Actual Loops': 0, 'Output': ['lineitem.l_orderkey', 'lineitem.l_partkey', 'lineitem.l_suppkey', 'lineitem.l_linenumber', 'lineitem.l_quantity', 'lineitem.l_extendedprice', 'lineitem.l_discount', 'lineitem.l_tax', 'lineitem.l_returnflag', 'lineitem.l_linestatus', 'lineitem.l_shipdate', 'lineitem.l_commitdate', 'lineitem.l_receiptdate', 'lineitem.l_shipinstruct', 'lineitem.l_shipmode', 'lineitem.l_comment'], 'Index Cond': '(lineitem.l_orderkey = orders.o_orderkey)', 'Rows Removed by Index Recheck': 0, 'Shared Hit Blocks': 0, 'Shared Read Blocks': 0, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 0, 'Temp Written Blocks': 0}]}]}]}]}, 'Planning Time': 0.496, 'Triggers': [], 'Execution Time': 1170.99}],)]
        query_result_modified = [([{'Plan': {'Node Type': 'Sort', 'Parallel Aware': False, 'Startup Cost': 2049081.76, 'Total Cost': 2056582.84, 'Plan Rows': 3000434, 'Plan Width': 71, 'Actual Startup Time': 5238.981, 'Actual Total Time': 5238.984, 'Actual Rows': 57, 'Actual Loops': 1, 'Output': ['customer.c_name', 'customer.c_custkey', 'orders.o_orderkey', 'orders.o_orderdate', 'orders.o_totalprice', '(sum(lineitem.l_quantity))'], 'Sort Key': ['orders.o_totalprice DESC', 'orders.o_orderdate'], 'Sort Method': 'quicksort', 'Sort Space Used': 29, 'Sort Space Type': 'Memory', 'Shared Hit Blocks': 196839, 'Shared Read Blocks': 269219, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 18269, 'Temp Written Blocks': 23351, 'Plans': [{'Node Type': 'Aggregate', 'Strategy': 'Sorted', 'Partial Mode': 'Simple', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Startup Cost': 1412640.2, 'Total Cost': 1480149.97, 'Plan Rows': 3000434, 'Plan Width': 71, 'Actual Startup Time': 5238.867, 'Actual Total Time': 5238.962, 'Actual Rows': 57, 'Actual Loops': 1, 'Output': ['customer.c_name', 'customer.c_custkey', 'orders.o_orderkey', 'orders.o_orderdate', 'orders.o_totalprice', 'sum(lineitem.l_quantity)'], 'Group Key': ['customer.c_custkey', 'orders.o_orderkey'], 'Shared Hit Blocks': 196839, 'Shared Read Blocks': 269219, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 18269, 'Temp Written Blocks': 23351, 'Plans': [{'Node Type': 'Sort', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Startup Cost': 1412640.2, 'Total Cost': 1420141.29, 'Plan Rows': 3000434, 'Plan Width': 44, 'Actual Startup Time': 5238.856, 'Actual Total Time': 5238.876, 'Actual Rows': 399, 'Actual Loops': 1, 'Output': ['customer.c_custkey', 'orders.o_orderkey', 'customer.c_name', 'orders.o_orderdate', 'orders.o_totalprice', 'lineitem.l_quantity'], 'Sort Key': ['customer.c_custkey', 'orders.o_orderkey'], 'Sort Method': 'quicksort', 'Sort Space Used': 56, 'Sort Space Type': 'Memory', 'Shared Hit Blocks': 196839, 'Shared Read Blocks': 269219, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 18269, 'Temp Written Blocks': 23351, 'Plans': [{'Node Type': 'Hash Join', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Join Type': 'Inner', 'Startup Cost': 615008.88, 'Total Cost': 905238.42, 'Plan Rows': 3000434, 'Plan Width': 44, 'Actual Startup Time': 3848.136, 'Actual Total Time': 5238.716, 'Actual Rows': 399, 'Actual Loops': 1, 'Output': ['customer.c_custkey', 'orders.o_orderkey', 'customer.c_name', 'orders.o_orderdate', 'orders.o_totalprice', 'lineitem.l_quantity'], 'Hash Cond': '(lineitem.l_orderkey = orders.o_orderkey)', 'Shared Hit Blocks': 196839, 'Shared Read Blocks': 269219, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 18269, 'Temp Written Blocks': 23351, 'Plans': [{'Node Type': 'Seq Scan', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Relation Name': 'lineitem', 'Schema': 'public', 'Alias': 'lineitem', 'Startup Cost': 0.0, 'Total Cost': 172517.69, 'Plan Rows': 6001469, 'Plan Width': 9, 'Actual Startup Time': 0.009, 'Actual Total Time': 943.539, 'Actual Rows': 6001215, 'Actual Loops': 1, 'Output': ['lineitem.l_quantity', 'lineitem.l_orderkey'], 'Shared Hit Blocks': 12476, 'Shared Read Blocks': 100027, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 0, 'Temp Written Blocks': 0}, {'Node Type': 'Hash', 'Parent Relationship': 'Inner', 'Parallel Aware': False, 'Startup Cost': 599042.82, 'Total Cost': 599042.82, 'Plan Rows': 749925, 'Plan Width': 43, 'Actual Startup Time': 3200.546, 'Actual Total Time': 3200.546, 'Actual Rows': 57, 'Actual Loops': 1, 'Output': ['customer.c_name', 'customer.c_custkey', 'orders.o_orderkey', 'orders.o_orderdate', 'orders.o_totalprice', 'lineitem_1.l_orderkey'], 'Hash Buckets': 65536, 'Original Hash Buckets': 65536, 'Hash Batches': 32, 'Original Hash Batches': 32, 'Peak Memory Usage': 513, 'Shared Hit Blocks': 184363, 'Shared Read Blocks': 169192, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 613, 'Temp Written Blocks': 607, 'Plans': [{'Node Type': 'Hash Join', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Join Type': 'Inner', 'Startup Cost': 8213.7, 'Total Cost': 599042.82, 'Plan Rows': 749925, 'Plan Width': 43, 'Actual Startup Time': 516.873, 'Actual Total Time': 3195.648, 'Actual Rows': 57, 'Actual Loops': 1, 'Output': ['customer.c_name', 'customer.c_custkey', 'orders.o_orderkey', 'orders.o_orderdate', 'orders.o_totalprice', 'lineitem_1.l_orderkey'], 'Hash Cond': '(orders.o_custkey = customer.c_custkey)', 'Shared Hit Blocks': 184363, 'Shared Read Blocks': 169192, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 613, 'Temp Written Blocks': 607, 'Plans': [{'Node Type': 'Merge Join', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Join Type': 'Semi', 'Startup Cost': 0.86, 'Total Cost': 570849.23, 'Plan Rows': 750000, 'Plan Width': 24, 'Actual Startup Time': 3.564, 'Actual Total Time': 3117.315, 'Actual Rows': 57, 'Actual Loops': 1, 'Output': ['orders.o_orderkey', 'orders.o_orderdate', 'orders.o_totalprice', 'orders.o_custkey', 'lineitem_1.l_orderkey'], 'Merge Cond': '(orders.o_orderkey = lineitem_1.l_orderkey)', 'Shared Hit Blocks': 184361, 'Shared Read Blocks': 165609, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 0, 'Temp Written Blocks': 0, 'Plans': [{'Node Type': 'Index Scan', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Scan Direction': 'Forward', 'Index Name': 'orders_pkey', 'Relation Name': 'orders', 'Schema': 'public', 'Alias': 'orders', 'Startup Cost': 0.43, 'Total Cost': 65058.43, 'Plan Rows': 1500000, 'Plan Width': 20, 'Actual Startup Time': 0.004, 'Actual Total Time': 321.526, 'Actual Rows': 1496151, 'Actual Loops': 1, 'Output': ['orders.o_orderkey', 'orders.o_custkey', 'orders.o_orderstatus', 'orders.o_totalprice', 'orders.o_orderdate', 'orders.o_orderpriority', 'orders.o_clerk', 'orders.o_shippriority', 'orders.o_comment'], 'Shared Hit Blocks': 2302, 'Shared Read Blocks': 30114, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 0, 'Temp Written Blocks': 0}, {'Node Type': 'Materialize', 'Parent Relationship': 'Inner', 'Parallel Aware': False, 'Startup Cost': 0.43, 'Total Cost': 497237.68, 'Plan Rows': 384250, 'Plan Width': 4, 'Actual Startup Time': 3.176, 'Actual Total Time': 2725.559, 'Actual Rows': 57, 'Actual Loops': 1, 'Output': ['lineitem_1.l_orderkey'], 'Shared Hit Blocks': 182059, 'Shared Read Blocks': 135495, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 0, 'Temp Written Blocks': 0, 'Plans': [{'Node Type': 'Aggregate', 'Strategy': 'Sorted', 'Partial Mode': 'Simple', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Startup Cost': 0.43, 'Total Cost': 492434.55, 'Plan Rows': 384250, 'Plan Width': 4, 'Actual Startup Time': 3.174, 'Actual Total Time': 2725.503, 'Actual Rows': 57, 'Actual Loops': 1, 'Output': ['lineitem_1.l_orderkey'], 'Group Key': ['lineitem_1.l_orderkey'], 'Filter': "(sum(lineitem_1.l_quantity) > '300'::numeric)", 'Rows Removed by Filter': 1499943, 'Shared Hit Blocks': 182059, 'Shared Read Blocks': 135495, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 0, 'Temp Written Blocks': 0, 'Plans': [{'Node Type': 'Index Scan', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Scan Direction': 'Forward', 'Index Name': 'lineitem_pkey', 'Relation Name': 'lineitem', 'Schema': 'public', 'Alias': 'lineitem_1', 'Startup Cost': 0.43, 'Total Cost': 457627.06, 'Plan Rows': 6000873, 'Plan Width': 9, 'Actual Startup Time': 0.003, 'Actual Total Time': 1796.17, 'Actual Rows': 6001214, 'Actual Loops': 1, 'Output': ['lineitem_1.l_orderkey', 'lineitem_1.l_partkey', 'lineitem_1.l_suppkey', 'lineitem_1.l_linenumber', 'lineitem_1.l_quantity', 'lineitem_1.l_extendedprice', 'lineitem_1.l_discount', 'lineitem_1.l_tax', 'lineitem_1.l_returnflag', 'lineitem_1.l_linestatus', 'lineitem_1.l_shipdate', 'lineitem_1.l_commitdate', 'lineitem_1.l_receiptdate', 'lineitem_1.l_shipinstruct', 'lineitem_1.l_shipmode', 'lineitem_1.l_comment'], 'Filter': '(lineitem_1.l_extendedprice < 104949.50)', 'Rows Removed by Filter': 1, 'Shared Hit Blocks': 182059, 'Shared Read Blocks': 135495, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 0, 'Temp Written Blocks': 0}]}]}]}, {'Node Type': 'Hash', 'Parent Relationship': 'Inner', 'Parallel Aware': False, 'Startup Cost': 5459.51, 'Total Cost': 5459.51, 'Plan Rows': 149946, 'Plan Width': 23, 'Actual Startup Time': 63.895, 'Actual Total Time': 63.895, 'Actual Rows': 149999, 'Actual Loops': 1, 'Output': ['customer.c_name', 'customer.c_custkey'], 'Hash Buckets': 65536, 'Original Hash Buckets': 65536, 'Hash Batches': 4, 'Original Hash Batches': 4, 'Peak Memory Usage': 2579, 'Shared Hit Blocks': 2, 'Shared Read Blocks': 3583, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 0, 'Temp Written Blocks': 601, 'Plans': [{'Node Type': 'Seq Scan', 'Parent Relationship': 'Outer', 'Parallel Aware': False, 'Relation Name': 'customer', 'Schema': 'public', 'Alias': 'customer', 'Startup Cost': 0.0, 'Total Cost': 5459.51, 'Plan Rows': 149946, 'Plan Width': 23, 'Actual Startup Time': 0.008, 'Actual Total Time': 41.335, 'Actual Rows': 149999, 'Actual Loops': 1, 'Output': ['customer.c_name', 'customer.c_custkey'], 'Filter': '(customer.c_acctbal < 9999.99)', 'Rows Removed by Filter': 1, 'Shared Hit Blocks': 2, 'Shared Read Blocks': 3583, 'Shared Dirtied Blocks': 0, 'Shared Written Blocks': 0, 'Local Hit Blocks': 0, 'Local Read Blocks': 0, 'Local Dirtied Blocks': 0, 'Local Written Blocks': 0, 'Temp Read Blocks': 0, 'Temp Written Blocks': 0}]}]}]}]}]}]}]}, 'Planning Time': 1.384, 'Triggers': [], 'Execution Time': 5239.39}],)]
        query_result_base_obj = json.loads(json.dumps(query_result_base[0][0]))
        query_result_modified_obj = json.loads(json.dumps(query_result_modified[0][0]))

        query_describe_base = get_description(query_result_base_obj)
        query_describe_modified = get_description(query_result_modified_obj)
    st.write('Query 1 Description: ', query_describe_base)
    st.write('Query 2 Description: ', query_describe_modified)

    # query_result_base_tree = get_tree(query_result_base_obj)
    # query_result_modified_tree = get_tree(query_result_modified_obj)
    query_result_diff = get_difference(query_result_base_obj, query_result_modified_obj)

    st.write('Query Difference: \n', query_result_diff)




